{% extends 'base.html' %} {% block content %}

<!-- call to action -->
<section>
    <div class="splash-container search-splash">
        <div class="row  valign-wrapper">
            <div class="col s8 offset-s2 m6 offset-m3 ">
                <h6 class="flow-text center-align">Search for recipes by category</h6>
            </div>
        </div>
    </div>
</section>

<!-- details and information -->
<section>
    <div class="search-button-container">
        <div class="row">
            <div class="col s4 m2 valign-wrapper waves-effect waves-light search-button">
                <p class="center-align flow-text">Ingredients</p>
                </a>
            </div>
            <div class="col s4 m2 valign-wrapper waves-effect waves-light search-button">
                <p class="center-align flow-text ">Allergies</p>
            </div>
            <div class="col s4 m2 valign-wrapper waves-effect waves-light search-button">
                <p class="center-align flow-text ">Difficulty</p>
            </div>
            <div class="col s4 m2 valign-wrapper waves-effect waves-light search-button">
                <p class="center-align flow-text ">Meal</p>
                </p>
            </div>
            <div class="col s4 m2 valign-wrapper waves-effect waves-light search-button">
                <p class="center-align flow-text ">Country</p>
            </div>
            <div class="col s4 m2 valign-wrapper waves-effect waves-light search-button">
                <p class="center-align flow-text ">Author</p>
            </div>
        </div>
    </div>
</section>

<section class="search-container">
    <div class="row" id="category-search" style="display:none">
        <div class="col s12">
            <ul >
                <li>
                    <div ><i class="material-icons expand">expand_more</i><i class="material-icons">search</i>Search Category:&nbsp<span id="search-category"></span></div>
                    <div >
                        <form action="{{url_for('display_categories')}}" id="categories" method="POST">
                            <div class="list-category input-field" id="list-element-ingredients">
                                <select name="ingredients" multiple>
                                    {%for ingredient in category_list["ingredients"] %}
                                    <option value="{{ingredient}}">{{ingredient}}</option>

                                    {%endfor%}
                                </select>
                            </div>

                            <div class="list-category input-field" id="list-element-allergies">
                                <select name="allergens" multiple>
                                    {%for allergy in category_list["allergens"] %}
                                    <option value="{{allergy}}">{{allergy}}</option>
                                    {%endfor%}
                                </select>
                            </div>

                            <div class="list-category input-field" id="list-element-difficulty">
                                <select name="difficulty" multiple>
                                    <option value="hard">Hard</option>
                                    <option value="medium">Medium</option>
                                    <option value="easy">Easy</option>
                                </select>
                            </div>

                            <div class="list-category input-field" id="list-element-meal">
                                <select name="meal" multiple>
                                    {%for meal in category_list["meal"] %}
                                    <option value="{{meal}}">{{meal}}</option>
                                    {%endfor%}
                                </select>
                            </div>

                            <div class="list-category input-field" id="list-element-country">
                                <select name="country" multiple>
                                    {%for country in category_list["country"] %}
                                    <option value="{{country}}">{{country}}</option>
                                    {%endfor%}
                                </select>
                            </div>

                            <div class="list-category input-field" id="list-element-author">
                                <select name="author" multiple>
                                    {%for author in category_list["author"] %}
                                    <option value="{{time}}">{{author}}</option>
                                    {%endfor%}
                                </select>
                            </div>
                            
                            <div class="row">
                                <div class="col s5 offset-s1 m3 offset-m2 ">
                                    <button type="reset" id="modal_reset" class="modal-close waves-effect waves-light btn btn-block hide-on-med-and-up red">Cancel</button>
                                    <button type="reset" id="modal_reset" class="waves-effect waves-light btn-large btn-block hide-on-small-only red">Cancel</button>
                                </div>
                                <div class="col s5 offset-s1 m3 offset-m2 ">
                                    <button type="submit" class="waves-effect waves-light btn btn-block hide-on-med-and-up highlight1-background">Submit</button>
                                    <button type="submit" class="waves-effect waves-light btn-large btn-block hide-on-small-only highlight1-background">Submit</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </li>
        </div>
    </div>
    <div>
        <div class="row">
            <div class="col s4 offset-s1 m2 offset-m3 ">
                <a href="{{url_for('index')}}" class="waves-effect waves-light btn btn-block hide-on-med-and-up highlight4-background">Home</a>
                <a href="{{url_for('index')}}" class="waves-effect waves-light btn-large btn-block hide-on-small-only highlight4-background">Home</a>
            </div>
            <div class="col s4 offset-s2 m2 offset-m2 ">
                <a href="{{url_for('recipe_list', action='search')}}" class="waves-effect waves-light btn btn-block hide-on-med-and-up highlight2-background">Search</a>
                <a href="{{url_for('recipe_list', action='search')}}" class="waves-effect waves-light btn-large btn-block hide-on-small-only highlight2-background">Search</a>
            </div>
        </div>
    </div>    
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
    $(".search-button").on("click", function() {
        var category = $(this).children("p").text();
        var categorySearchPane = $("#category-search");
        var listElement="#list-element-"+category.toLowerCase();
        $(".list-category").hide();   
        //reset the form to ensure only one category is returned to display_category when submitting 
        $('#categories')[0].reset();
        if ($(categorySearchPane).attr("data")) {
            if($(categorySearchPane).attr("data")!=category) {
                $(categorySearchPane).attr("data", category); 
                $(listElement).show();      
                $("#search-category").text(category)
            }
            else {
                $(categorySearchPane).slideUp();
                $(categorySearchPane).removeAttr("data");   
            }
        }
        else {
            console.log("open does not exist so setting to category")
            $(categorySearchPane).slideDown();
            $(categorySearchPane).attr("data", category);
            console.log($(categorySearchPane).attr("data"))
            $(listElement).show();
            $("#search-category").text(category)
        }


    })
</script>

{% endblock %}
