{% extends 'base.html' %} {% block content %}

<!-- call to action -->
<div class="hide-on-small-only top-margin-page-divider">
  <div class="row">
    <div class="col m10 offset-m1">
      <div class="col center-align m3">
        <div class="left-align page-divider highlight3-background"></div>
      </div>
      <div class="col center-align m3">
        <div class="center-align page-divider highlight1-background"></div>
      </div>
      <div class="col center-align m3">
        <div class=" center-align page-divider highlight2-background"></div>
      </div>
      <div class="col center-align m3">
        <div class="center-align page-divider highlight4-background"></div>
      </div>
    </div>
  </div>
</div>
<div class="row hide-on-small-only information-container">
  <div class="col s12">
    <h5 class="center-align">Create your own recipe</h5>
  </div>
  <div class="row">
    <div class="col s10 offset-s1">
      <p class="left-align">Fill out the form below to add your own creation to the Cookbook. Make sure you name it, add your ingredients and the instructions.</h5>
    </div>
  </div>
</div>

<!-- Add recipe form -->
<section class="recipe-form">
  <div class="row">
    <!--set the edit variable to false to tell flask this is a new recipe being added so no need to request the recipe_id-->
    <form id="recipe-form" action="{{url_for('insertrecipe', edit='False') }}" method="POST" class="col s12">
      <div class="row">
        <div class="col s10 offset-s1">
          <div class="row">
            <div class="col s10 input-field">
              <label for="name">Name</label>
              <input id="name" name="name" type="text" label="Name" required></input>
            </div>
            <div class="col s1 offset-s1 valign-wrapper">
              <p id="favourite"><i id="star" class=" material-icons">star_border</i></p>
              <input type="hidden" id="favourite_input" name="favourite" value=false></input>
            </div>
          </div>

          <div class="row">
            <div class="col s12 m6 input-field">
              <label for="country">Country of origin</label>
              <input id="country" class="autocomplete text-only" name="country" type="text"></input>
            </div>

            <div class="col s12 m6 input-field">
              <label for="picture">Picture</label>
              <input id="picture" name="picture" type="text" placeholder="type in full URL of image"></input>
            </div>
          </div>

          <div class="row">
            <div class="col s12 m4 l3 input-field">
              <select name="allergens" id="select_allergens" multiple>
                <option value="dairy">DAIRY</option>
                <option value="fish">FISH</option>
                <option value="gluten">GLUTEN</option>
                <option value="nuts">NUTS</option>
                <option value="shellfish">SHELLFISH</option>
                <option value="eggs">EGGS</option>
                <option value="meat">MEAT</option>
              </select>
              <label for="allergens">Contains:</label>
            </div>
            
            
            <div class="col s6 m3 input-field">
              <select name="meal">
                <option value="" disabled selected>Select</option>
                <option value="breakfast">BREAKFAST</option>
                <option value="lunch">LUNCH</option>
                <option value="dinner">DINNER</option>
                <option value="snack">SNACK</option>
                </select>
              <label for="meal">Meal</label>
            </div>

            <div class="col s6 m3 input-field">
              <select name="difficulty">
                <option value="" disabled selected>Select</option>
                <option value="easy">EASY</option>
                <option value="medium">MEDIUM</option>
                <option value="hard">HARD</option>
                </select>
              <label for="difficulty">Difficulty</label>
            </div>

            <div class="col s3 l1 input-field">
              <input name="hours" type="number" placeholder="hours"></input>
              <label for="hours">Cooking Time</label>
            </div>
            <div class="col m2 s3 l1 input-field">
              <input name="minutes" type="number" placeholder="minutes"></input>
            </div>
            <div class="col s3 m2 l1 input-field">
              <input name="calories" type="number" placeholder="calories"></input>
              <label for="calories">Calories</label>
            </div>
          </div>

          <div class="row">
            <div class="col s12">
              <p>Ingredients</p>
            </div>
          </div>
          <div id="ingredients">
          </div>          
          <div class="row">
            <div class="col s12 m5 l4 input-field">
              <label for="ingredient">Ingredient</label>
              <input class="autocomplete" id="ingredient" type="text">
            </div>
            <div class="col s3 m2 l2 input-field">
              <label for="amount">Quantity</label>
              <input id="amount" type="number" min="0"></input>
            </div>
            <div id="unit" class="col s3 m2 l1 input-field" >
              <select id="select-unit">
                <option value="" selected="selected"> </option>
                <option value="g">g</option>
                <option value="kg">kg</option>
                <option value="ml">ml</option>
                <option value="ltr">ltr</option>
                <option value="tsp">tsp</option>
                <option value="tbsp">tbsp</option>
              </select>
              <label for="select-unit">Unit</label>
            </div>
            <div class="col s1 add-ingredient-button">
              <a id="add_ingredient" class="btn-floating btn-small waves-effect waves-light highlight3-background"><i class="material-icons">add</i></a>
            </div>              

          </div>
        
          <div class="row">
            <div class="col s12 input-field">
              <label for="method">Method</label>
              <textarea id="method" name="method" class="materialize-textarea" label="method" required></textarea>
            </div>
          </div>

        </div>
      </div>
      <div class="row">
        <div class="col s4 offset-s1 m2 offset-m3 ">
          <a href="{{url_for('index')}}" class="waves-effect waves-light btn btn-block hide-on-large-only highlight2-background">Home</a>
          <a href="{{url_for('index')}}" class="waves-effect waves-light btn-large btn-block hide-on-med-and-down highlight2-background">Home</a>
        </div>
        <div class="col s4 offset-s2 m2 offset-m2 ">
          <button type="button" class="submit-recipe waves-effect waves-light btn btn-block hide-on-large-only highlight4-background">Add</button>
          <button type="button" class="submit-recipe waves-effect waves-light btn-large btn-block hide-on-small-only hide-on-med-and-down highlight4-background">Add</button>
        </div>
      </div>
      <!--author field - takes value of user logged in - not displayed -->
      <input id="author" type="hidden" name="author" type="text" value="{{session['user']}}"></input>
    </form>
  </div>
</section>

<!--Error modal -->
<section>
  <div id="error-modal" class="modal">
    <div class="modal-content">
      <h4>Error</h4>
      <p>Please input </p>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-close waves-effect waves-light btn-flat background-highlight3">OK</a>
    </div>
  </div>
</section>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script type="text/javascript" src="{{url_for('static', filename='js/jquery.alphanum.js')}}"></script>

<script type="text/javascript">
  $(document).ready(function() {
    var ingredient_list = {{ingredients_list|tojson}};
    var country_list = {{country_list|tojson}};

    $('#ingredient').autocomplete({
      data: ingredient_list,
    });
    $('#country').autocomplete({
      data: country_list,
    });


  })
  $('.text-only').alpha();  /*
    $("#add_ingredient").on("click", function() {
      var totalIngredients = $("#ingredients").data("total_ingredients");
      totalIngredients++;
      $("#ingredients").data("total_ingredients", totalIngredients);
      var currentIngredient = $("#ingredient").val();
      var currentAmount = $("#amount").val();
      var currentUnit = $("#unit option:selected").val()
      var currentIngredients = $("#ingredients").html()
      //build an array of current ingredients, to check against the current ingredient being entered to throw an error if a duplicate ingredient is added.
      var ingredientList=[];
      $(".ingredient-type").each(function(i,object) {
        ingredientList[i]=$(object).attr("value");
      })
      
      //check if amount of ingredients has been entered - check against whether a number is input and whether string is empty
      if (isNaN(currentAmount) || currentAmount.length == 0 || currentAmount == undefined) {
        //display error modal
        $("#error-modal p").text("Please enter amount of ingredients")
        $("#error-modal").modal('open');
      }
      else if (currentIngredient.length == 0 || currentIngredient == undefined) {
        //display error modal
        $("#error-modal p").text("Please enter ingredient name")
        $("#error-modal").modal('open');
      }
      //check the ingredient being added against the current ingredients. If duplicate, display error modal.
      else if(ingredientList.indexOf(currentIngredient)!=-1) {
        $("#error-modal p").text("You have entered a duplicate ingredient. Check and try again.")
        $("#error-modal").modal('open');      
      }
      else {
        if (currentUnit === "0") { currentUnit = "" }
        console.log(currentIngredient)
        $("#ingredients").html(currentIngredients + "<div class='row'><div class='col s1 valign-wrapper'><p>" + currentAmount + "</p></div><div class='col s2 valign-wrapper'><p>" + currentUnit + "</p></div><div class='col s7'><p>" + currentIngredient + " </p></div><div class='col s1'><a id='remove_ingredient' class='btn-floating btn-small waves-effect waves-light highlight3-background'><i class='material-icons'>delete</i></a></div></div><input id='ingredd' class='ingredient-type' type='hidden' name='type' value='" + currentIngredient + "'></input><input type='hidden' name='amount' value=" + currentAmount + "></input><input type='hidden' name='unit' value=" + currentUnit + "></input>")
        $("#ingredient").val('');
        $("#amount").val('');
        $("#select-unit").val('');
        $('#select-unit').formSelect();
        console.log("value ",$("#ingredd").val())
      }
    });

    $('body').on("click", "#remove_ingredient", function() {
      $(this).parent().parent().slideUp(500);
      setTimeout(function() { $(this).parent().parent().remove(); }, 500);
    });
    
    $("#submit-recipe").on("click", function() {
      var name=$("#name").val();
      var ingredient=$('#ingredients').find('input').filter(':hidden:first').val();
      var method=$('#method').val();
      if(name=="") {
        $("#error-modal p").text("You need to name your recipe")
        $("#error-modal").modal('open');
      }
      else if(ingredient==undefined || ingredient==""){
        $("#error-modal p").text("You need at least one ingredient for your recipe")
        $("#error-modal").modal('open');      
      }
      else if(method==""){
        $("#error-modal p").text("You need to provide instructions as to how to make your recipe")
        $("#error-modal").modal('open');      
      }
      else {
        $("#recipe-form").submit();  
      }
    })
    
      */
</script>

{% endblock %}
