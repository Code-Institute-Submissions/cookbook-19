{% extends 'base.html' %} {% block content %}

<!-- call to action -->
<!-- Add recipe form -->
<section>
  <div class="row">
    <!--set the edit variable to false to tell flask this is a new recipe being added so no need to request the recipe_id-->
    <form action="{{url_for('insertrecipe', edit=False) }}" method="POST" class="col s10 offset-s1">

      <div class="row">
        <div class="col s10">
          <label>Name</label>
          <input id="name" name="name" type="text" label="Name" required></input>
        </div>
        <div class="col s2 valign-wrapper">
          <p id="favourite"><i id="star" class="material-icons">star_border</i></p>
          <input type="hidden" id="favourite_input" name="favourite" value=false></input>
        </div>
      </div>

      <div class="row">
        <div class="col s12">
          <label>Country of origin</label>
          <input id="country" name="country" type="text"></input>
        </div>
      </div>

      <div class="row">
        <div class="col s12">
          <label>Recipe Author</label>
          <input id="country" name="author" type="text" placeholder="Firstname Lastname"></input>
        </div>
      </div>

      <div class="row">
        <div class="col s12">
          <label>Picture</label>
          <input id="picture" name="picture" type="text" placeholder="type in full URL of image"></input>
        </div>
      </div>

      <div class="row ">
        <div class="col s6">
          <label>Meal</label>
          <div class="input-field">
            <select name="meal">
              <option value="" disabled selected>Select</option>
              <option value="BREAKFAST">BREAKFAST</option>
              <option value="LUNCH">DINNER</option>
              <option value="DINNER">DINNER</option>
              <option value="SNACK">SNACK</option>
            </select>
          </div>
        </div>

        <div class="col s6">
          <label>Difficulty</label>
          <div class="input-field">
            <select name="difficulty">
              <option value="" disabled selected>Select</option>
              <option value="EASY">EASY</option>
              <option value="MEDIUM">MEDIUM</option>
              <option value="HARD">HARD</option>
            </select>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col s3">
          <label>Cooking time</label>
          <input name="hours" type="number" value="0" placeholder="hours"></input>
        </div>
        <div class="col s3">
          <label>&nbsp</label>
          <input name="minutes" type="number" value="0" placeholder="minutes"></input>
        </div>
        <div class="col s3 offset-s3">
          <label>Calories</label>
          <input name="calories" type="number" placeholder="calories"></input>
        </div>
      </div>

      <div class="row ">
        <div class="col s12">
          <p>Ingredients</p>
        </div>
      </div>
      <div class="row">
        <div class="col s6">
          <label>Ingredient</label>
          <input id="ingredient"  type="text"></input>
        </div>
        <div class="col s2">
          <label>Quantity</label>
          <input id="amount" type="number" min="0">
        </div>
        <div class="col s2" style="padding-right:2px">
          <label>Unit</label>
          <div id="unit" class="input-field">
            <select>
              <option value="0"> </option>
              <option value="g">g</option>
              <option value="kg">kg</option>
              <option value="ml">ml</option>
              <option value="ltr">ltr</option>
              <option value="tsp">tsp</option>
              <option value="tbsp">tbsp</option>
            </select>
          </div>
        </div>
        <div class="col s1">
          <a id="add_ingredient" class="btn-floating btn-small waves-effect waves-light highlight3-background"><i class="material-icons">add</i></a>
        </div>
      </div>
      <div id="ingredients">
      </div>
      <div class="row ">
        <div class="col s12">
          <label for="select_allergens">Allergens</label>
          <div class="input-field">
            <select name="allergens" id="select_allergens" multiple>
              <option value="dairy">DAIRY</option>
              <option value="fish">FISH</option>
              <option value="gluten">GLUTEN</option>
              <option value="nuts">NUTS</option>
              <option value="shellfish">SHELLFISH</option>
              <option value="eggs">EGGS</option>
            </select>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col s12 input-field">
          <label for="method">Method</label>
          <textarea name="method" class="materialize-textarea" label="method" required></textarea>
        </div>
      </div>
  <div class="row valign-wrapper">
    <div class="col s6 offset-s3 m2 offset-m5 ">
      <button id="submit_recipe" class="waves-effect waves-light btn btn-block hide-on-med-and-up highlight4-background"type="submit">Add</button>
      <button id="submit_recipe" class="waves-effect waves-light btn-large btn-block hide-on-small-only highlight4-background" type="submit">Add</button>
    </div>
  </div>      
    </form>
  </div>
  

</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script type="text/javascript">
  $("#add_ingredient").on("click", function() {
    var totalIngredients = $("#ingredients").data("total_ingredients");
    totalIngredients++;
    $("#ingredients").data("total_ingredients", totalIngredients);
    var currentIngredient = $("#ingredient").val();
    var currentAmount = $("#amount").val();
    var currentUnit = $("#unit option:selected").val()
    var currentIngredients = $("#ingredients").html()
    if (isNaN(currentAmount)) {
      //display error modal
      alert("not a number")
    }
    else if (currentIngredient == "" || currentIngredient == undefined) {
      //display error modal
      alert("ingredient not defined")
    }
    else {


      if(currentUnit==="0") { currentUnit="" }
      $("#ingredients").html(currentIngredients + "<div class='row'><div class='col s1 valign-wrapper'><p>" + currentAmount + "</p></div><div class='col s2 valign-wrapper'><p>" + currentUnit + "</p></div><div class='col s7'><p>" + currentIngredient + "</p></div><div class='col s1'><a id='remove_ingredient' class='btn-floating btn-small waves-effect waves-light highlight3-background'><i class='material-icons'>delete</i></a></div></div><input type='hidden' name='type' value="+currentIngredient+"></input><input type='hidden' name='amount' value="+currentAmount+"></input><input type='hidden' name='unit' value="+currentUnit+"></input>")
      $("#ingredient").val('');
      $("#amount").val('');
      $("#unit").val('');
    }
  });
  
  $('body').on("click", "#remove_ingredient", function() {

    $(this).parent().parent().slideUp(500);
    setTimeout(function() { $(this).parent().parent().remove(); }, 500);
  });
</script>

{% endblock %}
