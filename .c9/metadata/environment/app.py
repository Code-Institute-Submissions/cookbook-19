{"changed":true,"filter":false,"title":"app.py","tooltip":"/app.py","value":"import os\nfrom flask import Flask, render_template, request, redirect, flash, url_for, session\nfrom flask_pymongo import PyMongo\nfrom bson.objectid import ObjectId\n\napp=Flask(__name__)\n\napp.secret_key=os.getenv(\"SECRET\",\"randomstring123\")\n\napp.config[\"MONGO_DBNAME\"]='milestone-3'\napp.config[\"MONGO_URI\"]='mongodb+srv://Shilldon:Palad1n1@myfirstcluster-gzjbi.mongodb.net/milestone-3'\n\nmongo=PyMongo(app)\n\n@app.route(\"/\")\n\ndef index():\n    print(\"blanking session variable\")\n    session[\"filters\"]={}\n    session[\"sort\"]=\"\"\n    return render_template(\"index.html\",title_text='Perfect dishes on demand')\n\n@app.route(\"/add_recipe\")\n\ndef add_recipe():\n    return render_template(\"add_recipe.html\", title_text='Add recipe')\n\n@app.route(\"/insertrecipe/\", methods=['POST'])\ndef insertrecipe():\n    #check whether the user is adding a new recipe or editting a recipe\n    edit=request.args.get('edit',None)\n    \n\n        \n    recipes=mongo.db.recipeDB\n    \n    #if editing a recipe get the ID of the recipe to edit\n    if edit=='True':\n        recipe_id=ObjectId(request.args.get('recipe_id'))\n    else:\n        recipe_id=recipes.insert({'name':'new'})\n    \n    #request form data not in flat format - arrays are created in the form for ingredients and allergen information\n    new_recipe=request.form.to_dict(flat=False)\n    ingredients=[]\n    ingredient={}\n    #initialise cook time variable to convert hours and minutes to minutes total for ease of search DB in recipe_list\n    cook_time=0\n    for key, key_name in new_recipe.items():\n        #flatten dict for non-array items which have become arrays through request object\n        if key!='type' and key!='amount' and key!='unit' and key!='allergens':\n            new_recipe[key]=new_recipe[key][0]\n            if key=='favourite':\n                if new_recipe[key].lower() =='true':\n                    new_recipe[key]=True\n                else:\n                    new_recipe[key]=False    \n            if key=='hours' or key=='minutes' or key=='calories':\n                #convert from string to int, if needed\n                try:\n                    new_recipe[key]=int(new_recipe[key])\n                except ValueError:\n                    pass\n            if key=='hours':\n                #convert hours to minutes and add to cook time\n                cook_time=new_recipe[key]*60\n            if key=='minutes':\n                cook_time=cook_time+new_recipe[key]\n        elif key=='type':\n            #cycle through the ingredient information and create objects for each ingredient with key values of ingredient type, amount and units\n            i=0\n            for ingredient_type in key_name:\n\n                ingredient={ 'type' : ingredient_type , 'amount' : new_recipe['amount'][i] , 'unit' : new_recipe['unit'][i] }\n                #insert ingredient object into array of ingredients\n                ingredients.append(ingredient)\n                i+=1       \n    #insert the new cook_time key into the new_recipe dict\n    new_recipe[\"cook_time\"]=cook_time\n    #insert the new ingredients array into the new_receipe dict\n    new_recipe['ingredients']=ingredients            \n    \n    categories=[\"country\",\"author\"]\n    for category in categories:\n        if category==\"country\":\n            database=mongo.db.countriesDB\n        elif category==\"author\":\n            database=mongo.db.authorDB\n        update_country_database(edit,recipe_id,recipes,new_recipe,category,database)      \n\n    print(\"come bvack\")        \n\n    #need to remove the type, amount and unit arrays from the dict having imported them into ingredients objects\n    #done by error testing because ingredients may not have been added via the form\n    try:\n        del new_recipe['type']\n    except KeyError:\n        pass\n    try:\n        del new_recipe['amount']\n    except KeyError:\n        pass    \n    try:\n        del new_recipe['unit']\n    except KeyError:\n        pass    \n    \n    if edit=='True':\n        recipes.update({'_id':ObjectId(recipe_id)},new_recipe)\n    else:\n        recipes.update({'_id':ObjectId(recipe_id)},new_recipe)\n        \n    return redirect(url_for('show_recipe',recipe_id=recipe_id,added=\"true\"))\n\ndef update_country_database(edit,recipe_id,recipes,new_recipe,category,country_db):\n    print(\"edit \",edit)\n    print(\"recipe_id \",recipe_id)\n    print(\"reciopes \",recipes)\n    print(\"new recipe \",new_recipe)\n    print(\"category \", category)\n    #Update country database\n    if edit==\"True\":\n        current_recipe_doc=recipes.find_one({\"_id\" :recipe_id})\n    else:\n        current_recipe_doc={}\n\n    if new_recipe[category]:\n        new_country_doc=country_db.find_one({\"name\" : new_recipe[category]})\n        if new_country_doc!=None:\n            new_country_id=new_country_doc[\"_id\"]\n        else:\n            new_country_id=country_db.insert({\"name\" : new_recipe[category]})\n            new_country_doc=country_db.find_one({\"_id\" : new_country_id})\n    else:\n        new_country_doc={}\n        new_country_id=\"\"\n\n    if current_recipe_doc!={}:\n        current_country_id=current_recipe_doc[category]\n        current_country_doc=country_db.find_one({\"_id\" : current_country_id})\n    else:\n        current_country_id=\"\"\n        current_country_doc={}\n        print(\"current country_doc=\",current_country_doc)\n        \n\n    if new_country_doc!=current_country_doc:\n        if current_country_doc!={}:\n            country_db.update({\"_id\": current_country_id},{\"$pull\":{\"recipe\" : recipe_id}})\n            current_country_doc=country_db.find_one({\"_id\": current_country_id})\n            if len(current_country_doc[\"recipe\"])==0:\n                country_db.remove({\"_id\": current_country_id})    \n    \n    if new_country_doc!={}:\n        new_recipe[category]=new_country_doc[\"_id\"]\n        country_db.update({\"_id\": new_country_id},{\"$push\":{\"recipe\" : recipe_id}})\n        \n    return  \n\n@app.route(\"/search\")\ndef search():\n    return render_template(\"search.html\",title_text=\"Find your favourites\")\n\n@app.route(\"/recipe_list\", methods=['POST','GET'])\ndef recipe_list():\n\n    _sort=session[\"sort\"]\n    _filter_dict=session[\"filters\"]\n    if _filter_dict==None:\n        _filter_dict={}\n        \n    allergen_list=[]\n    #get the action request from the page to determine what sort of list is to be displayed and display appropriate title text \n    _todo=request.args.get('action',None)\n    if _todo==\"delete\":\n        title_text_value=\"Delete recipes\"\n    elif _todo==\"edit\":\n        title_text_value=\"Edit recipes\"\n    else:\n        title_text_value=\"Your recipes\"\n\n    #check if the results are to be filtered/sorted using variable passed from recipe_list\n    filter=request.args.get('filter',None)\n\n    if filter=='true':    \n        _currentsort=request.form.get('sort_by')\n        print(\"_sort=\",_sort)\n        if _currentsort!=None:\n            _sort=_currentsort\n            session[\"sort\"]=_sort\n        else:\n            filter_favourites=request.form.get('favourite')\n            if filter_favourites:\n                if filter_favourites=='false':\n                    filter_favourites=False\n                elif filter_favourites=='true':\n                    filter_favourites=True \n                _filter_dict.update({\"favourite\" : filter_favourites })\n            else:\n                _filter_dict.pop(\"favourite\",None)            \n                    \n            filter_meal=request.form.get('meal')\n            print(\"filter meal \",filter_meal)\n            if filter_meal!=\"\" and filter_meal!=None:\n                _filter_dict.update({\"meal\":filter_meal})\n            else:\n                _filter_dict.pop(\"meal\",None)\n            \n            filter_allergens=request.form.getlist('allergens')\n            if filter_allergens:\n                loop=0\n                for allergen in filter_allergens:\n                    allergen_list.append(allergen)\n                filter_allergens={  '$nin' : allergen_list }   \n                _filter_dict.update({\"allergens\" : filter_allergens}) \n            else:\n                _filter_dict.pop(\"allergens\",None)\n                \n            filter_calories=request.form.get('calories')\n            if filter_calories!=\"\" and filter_calories!=None:\n                if filter_calories==999:\n                    filter_calories={'$gt':filter_calories}\n                else:\n                    filter_calories={'$lt':filter_calories}  \n                _filter_dict.update({\"calories\":filter_calories})\n            else:\n                _filter_dict.pop(\"calories\",None)\n                \n            filter_cooktime=request.form.get('cook_time')\n            if filter_cooktime!=\"\" and filter_cooktime!=None:\n                if filter_cooktime==179:\n                    filter_cooktime={'$gt':filter_cooktime}\n                else:\n                    filter_cooktime={'$lt':filter_cooktime}  \n                _filter_dict.update({\"cook_time\" : filter_cooktime})\n            else:\n                _filter_dict.pop(\"cook_time\",None)\n                \n            filter_country=request.form.get('country')\n            if filter_country!=\"\" and filter_country!=None:\n                _filter_dict.update({\"country\" : filter_country})\n            else:\n                _filter_dict.pop(\"country\",None)\n            \n            filter_author=request.form.get('author')\n            if filter_author!=\"\" and filter_author!=None:\n                _filter_dict.update({\"author\" : filter_author})\n            else:\n                _filter_dict.pop(\"author\",None)\n                \n            session[\"filters\"]=_filter_dict\n\n        \n    if filter=='true':\n    #do the appropriate search and sort against the mongoDB depending on input from form/session variable\n        if _sort!=None and _sort!=\"none\":\n            _recipe_list=mongo.db.recipeDB.find(_filter_dict).sort(_sort,1) \n        else:\n            _recipe_list=mongo.db.recipeDB.find(_filter_dict)\n    else:\n        if _sort!=\"none\" and _sort!=None:\n            _recipe_list=mongo.db.recipeDB.find().sort(_sort,1) \n        else:      \n            _recipe_list=mongo.db.recipeDB.find()\n\n    #create a list of countries and authors referred to in recipe db to generate filters in recipe_list\n    full_list_of_country_recipes=mongo.db.countriesDB.find()\n    full_list_of_author_recipes=mongo.db.authorDB.find()\n    \n    #remove duplicates from the lists\n    _author_list=[]\n    for key in full_list_of_author_recipes:\n        if key==\"name\":\n            _author_list.append(key[\"name\"])\n            \n    _country_list=[]\n    for key in full_list_of_country_recipes:\n        if key==\"name\":\n            _country_list.append(key[\"name\"])    \n        \n    _total_results=_recipe_list.count()\n\n    return render_template(\"recipe_list.html\",title_text=title_text_value,recipes=_recipe_list,countries=_country_list,authors=_author_list,action=_todo,filters=_filter_dict, allergens=allergen_list, sort=_sort, total_results=_total_results)\n\n\n@app.route('/show_recipe/<recipe_id>')\ndef show_recipe(recipe_id):\n    _recipe=mongo.db.recipeDB.find_one({\"_id\":ObjectId(recipe_id)})\n    categories=[\"country\",\"author\"]\n    for category in categories:\n        if category==\"country\":\n            database=mongo.db.countriesDB\n        elif category==\"author\":\n            database=mongo.db.authorDB\n        if _recipe[category]:\n            _categorydoc=database.find_one({\"_id\":ObjectId(_recipe[category])})\n            print(\"category doc\",_categorydoc)\n            _recipe[category]=_categorydoc[\"name\"]\n    title_text='Your recipe'\n    print(\"checking session variable=\",session[\"filters\"])    \n    return render_template('display_recipe.html',title_text='Your recipe',recipe=_recipe,added=\"true\")\n\n@app.route('/edit_recipe/<recipe_id>')\ndef edit_recipe(recipe_id):\n    _recipe=mongo.db.recipeDB.find_one({\"_id\":ObjectId(recipe_id)})\n    categories=[\"country\",\"author\"]\n    for category in categories:\n        if category==\"country\":\n            database=mongo.db.countriesDB\n        elif category==\"author\":\n            database=mongo.db.authorDB\n        if _recipe[category]:\n            _categorydoc=database.find_one({\"_id\":ObjectId(_recipe[category])})\n            print(\"category doc\",_categorydoc)\n            _recipe[category]=_categorydoc[\"name\"]    \n    return render_template('edit_recipe.html',title_text=\"Edit your recipes\",recipe=_recipe)\n\n@app.route('/delete_recipe',methods=['POST'])\ndef delete_recipe():\n    recipe_id=request.form.get('recipe_id')\n    _recipe=mongo.db.recipeDB.remove({\"_id\":ObjectId(recipe_id)})\n    return redirect(url_for('.recipe_list',action='delete'))\n\n@app.route('/filter_recipes', methods=['POST'])\ndef filter_recipes():\n    session[\"filters\"]=request.form.to_dict()\n    calories=request.form[\"calories\"]\n    if calories:\n        session[\"filters\"][\"calories\"]=calories\n    return redirect('recipe_list')\n    \nif __name__ ==\"__main__\":\n    app.run(host=os.environ.get(\"IP\"), port=int(os.environ.get(\"PORT\")), debug=True)    \n    ","undoManager":{"mark":99,"position":100,"stack":[[{"start":{"row":298,"column":22},"end":{"row":298,"column":23},"action":"insert","lines":["c"],"id":9743},{"start":{"row":298,"column":23},"end":{"row":298,"column":24},"action":"insert","lines":["o"]},{"start":{"row":298,"column":24},"end":{"row":298,"column":25},"action":"insert","lines":["u"]},{"start":{"row":298,"column":25},"end":{"row":298,"column":26},"action":"insert","lines":["n"]},{"start":{"row":298,"column":26},"end":{"row":298,"column":27},"action":"insert","lines":["t"]},{"start":{"row":298,"column":27},"end":{"row":298,"column":28},"action":"insert","lines":["r"]},{"start":{"row":298,"column":28},"end":{"row":298,"column":29},"action":"insert","lines":["y"]}],[{"start":{"row":298,"column":30},"end":{"row":298,"column":31},"action":"insert","lines":[":"],"id":9744}],[{"start":{"row":298,"column":31},"end":{"row":299,"column":0},"action":"insert","lines":["",""],"id":9745},{"start":{"row":299,"column":0},"end":{"row":299,"column":12},"action":"insert","lines":["            "]},{"start":{"row":299,"column":12},"end":{"row":299,"column":13},"action":"insert","lines":["d"]},{"start":{"row":299,"column":13},"end":{"row":299,"column":14},"action":"insert","lines":["a"]}],[{"start":{"row":299,"column":14},"end":{"row":299,"column":15},"action":"insert","lines":["t"],"id":9746},{"start":{"row":299,"column":15},"end":{"row":299,"column":16},"action":"insert","lines":["a"]},{"start":{"row":299,"column":16},"end":{"row":299,"column":17},"action":"insert","lines":["b"]},{"start":{"row":299,"column":17},"end":{"row":299,"column":18},"action":"insert","lines":["a"]},{"start":{"row":299,"column":18},"end":{"row":299,"column":19},"action":"insert","lines":["s"]},{"start":{"row":299,"column":19},"end":{"row":299,"column":20},"action":"insert","lines":["e"]},{"start":{"row":299,"column":20},"end":{"row":299,"column":21},"action":"insert","lines":["="]}],[{"start":{"row":299,"column":21},"end":{"row":299,"column":22},"action":"insert","lines":["c"],"id":9747},{"start":{"row":299,"column":22},"end":{"row":299,"column":23},"action":"insert","lines":["o"]},{"start":{"row":299,"column":23},"end":{"row":299,"column":24},"action":"insert","lines":["u"]},{"start":{"row":299,"column":24},"end":{"row":299,"column":25},"action":"insert","lines":["n"]},{"start":{"row":299,"column":25},"end":{"row":299,"column":26},"action":"insert","lines":["t"]},{"start":{"row":299,"column":26},"end":{"row":299,"column":27},"action":"insert","lines":["r"]},{"start":{"row":299,"column":27},"end":{"row":299,"column":28},"action":"insert","lines":["i"]},{"start":{"row":299,"column":28},"end":{"row":299,"column":29},"action":"insert","lines":["e"]},{"start":{"row":299,"column":29},"end":{"row":299,"column":30},"action":"insert","lines":["s"]},{"start":{"row":299,"column":30},"end":{"row":299,"column":31},"action":"insert","lines":["D"]},{"start":{"row":299,"column":31},"end":{"row":299,"column":32},"action":"insert","lines":["B"]}],[{"start":{"row":299,"column":32},"end":{"row":300,"column":0},"action":"insert","lines":["",""],"id":9748},{"start":{"row":300,"column":0},"end":{"row":300,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":300,"column":8},"end":{"row":300,"column":9},"action":"insert","lines":["e"],"id":9749},{"start":{"row":300,"column":9},"end":{"row":300,"column":10},"action":"insert","lines":["l"]},{"start":{"row":300,"column":10},"end":{"row":300,"column":11},"action":"insert","lines":["i"]}],[{"start":{"row":300,"column":10},"end":{"row":300,"column":11},"action":"remove","lines":["i"],"id":9750}],[{"start":{"row":300,"column":10},"end":{"row":300,"column":11},"action":"insert","lines":["i"],"id":9751},{"start":{"row":300,"column":11},"end":{"row":300,"column":12},"action":"insert","lines":["f"]}],[{"start":{"row":299,"column":21},"end":{"row":299,"column":22},"action":"insert","lines":["m"],"id":9752},{"start":{"row":299,"column":22},"end":{"row":299,"column":23},"action":"insert","lines":["o"]},{"start":{"row":299,"column":23},"end":{"row":299,"column":24},"action":"insert","lines":["n"]},{"start":{"row":299,"column":24},"end":{"row":299,"column":25},"action":"insert","lines":["g"]},{"start":{"row":299,"column":25},"end":{"row":299,"column":26},"action":"insert","lines":["o"]},{"start":{"row":299,"column":26},"end":{"row":299,"column":27},"action":"insert","lines":["."]},{"start":{"row":299,"column":27},"end":{"row":299,"column":28},"action":"insert","lines":["d"]},{"start":{"row":299,"column":28},"end":{"row":299,"column":29},"action":"insert","lines":["b"]},{"start":{"row":299,"column":29},"end":{"row":299,"column":30},"action":"insert","lines":["."]}],[{"start":{"row":300,"column":13},"end":{"row":300,"column":14},"action":"insert","lines":["c"],"id":9753},{"start":{"row":300,"column":14},"end":{"row":300,"column":15},"action":"insert","lines":["a"]},{"start":{"row":300,"column":15},"end":{"row":300,"column":16},"action":"insert","lines":["t"]},{"start":{"row":300,"column":16},"end":{"row":300,"column":17},"action":"insert","lines":["e"]},{"start":{"row":300,"column":17},"end":{"row":300,"column":18},"action":"insert","lines":["g"]},{"start":{"row":300,"column":18},"end":{"row":300,"column":19},"action":"insert","lines":["o"]},{"start":{"row":300,"column":19},"end":{"row":300,"column":20},"action":"insert","lines":["r"]},{"start":{"row":300,"column":20},"end":{"row":300,"column":21},"action":"insert","lines":["y"]},{"start":{"row":300,"column":21},"end":{"row":300,"column":22},"action":"insert","lines":["="]}],[{"start":{"row":300,"column":22},"end":{"row":300,"column":24},"action":"insert","lines":["\"\""],"id":9754}],[{"start":{"row":300,"column":22},"end":{"row":300,"column":24},"action":"remove","lines":["\"\""],"id":9755}],[{"start":{"row":300,"column":22},"end":{"row":300,"column":23},"action":"insert","lines":["="],"id":9756}],[{"start":{"row":300,"column":23},"end":{"row":300,"column":25},"action":"insert","lines":["\"\""],"id":9757}],[{"start":{"row":300,"column":24},"end":{"row":300,"column":25},"action":"insert","lines":["a"],"id":9758},{"start":{"row":300,"column":25},"end":{"row":300,"column":26},"action":"insert","lines":["h"]}],[{"start":{"row":300,"column":25},"end":{"row":300,"column":26},"action":"remove","lines":["h"],"id":9759}],[{"start":{"row":300,"column":25},"end":{"row":300,"column":26},"action":"insert","lines":["h"],"id":9760}],[{"start":{"row":300,"column":25},"end":{"row":300,"column":26},"action":"remove","lines":["h"],"id":9761}],[{"start":{"row":300,"column":25},"end":{"row":300,"column":26},"action":"insert","lines":["u"],"id":9762},{"start":{"row":300,"column":26},"end":{"row":300,"column":27},"action":"insert","lines":["t"]},{"start":{"row":300,"column":27},"end":{"row":300,"column":28},"action":"insert","lines":["h"]},{"start":{"row":300,"column":28},"end":{"row":300,"column":29},"action":"insert","lines":["o"]},{"start":{"row":300,"column":29},"end":{"row":300,"column":30},"action":"insert","lines":["r"]}],[{"start":{"row":300,"column":31},"end":{"row":300,"column":34},"action":"remove","lines":["   "],"id":9763},{"start":{"row":300,"column":31},"end":{"row":301,"column":0},"action":"insert","lines":["",""]},{"start":{"row":301,"column":0},"end":{"row":301,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":301,"column":8},"end":{"row":301,"column":12},"action":"insert","lines":["    "],"id":9764}],[{"start":{"row":301,"column":8},"end":{"row":301,"column":12},"action":"remove","lines":["    "],"id":9765},{"start":{"row":301,"column":4},"end":{"row":301,"column":8},"action":"remove","lines":["    "]},{"start":{"row":301,"column":0},"end":{"row":301,"column":4},"action":"remove","lines":["    "]},{"start":{"row":300,"column":31},"end":{"row":301,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":300,"column":31},"end":{"row":300,"column":32},"action":"insert","lines":[":"],"id":9766}],[{"start":{"row":300,"column":32},"end":{"row":301,"column":0},"action":"insert","lines":["",""],"id":9767},{"start":{"row":301,"column":0},"end":{"row":301,"column":12},"action":"insert","lines":["            "]},{"start":{"row":301,"column":12},"end":{"row":301,"column":13},"action":"insert","lines":["d"]},{"start":{"row":301,"column":13},"end":{"row":301,"column":14},"action":"insert","lines":["a"]},{"start":{"row":301,"column":14},"end":{"row":301,"column":15},"action":"insert","lines":["t"]},{"start":{"row":301,"column":15},"end":{"row":301,"column":16},"action":"insert","lines":["a"]},{"start":{"row":301,"column":16},"end":{"row":301,"column":17},"action":"insert","lines":["b"]},{"start":{"row":301,"column":17},"end":{"row":301,"column":18},"action":"insert","lines":["a"]},{"start":{"row":301,"column":18},"end":{"row":301,"column":19},"action":"insert","lines":["s"]},{"start":{"row":301,"column":19},"end":{"row":301,"column":20},"action":"insert","lines":["e"]}],[{"start":{"row":301,"column":20},"end":{"row":301,"column":21},"action":"insert","lines":["="],"id":9768},{"start":{"row":301,"column":21},"end":{"row":301,"column":22},"action":"insert","lines":["m"]},{"start":{"row":301,"column":22},"end":{"row":301,"column":23},"action":"insert","lines":["o"]},{"start":{"row":301,"column":23},"end":{"row":301,"column":24},"action":"insert","lines":["g"]}],[{"start":{"row":301,"column":23},"end":{"row":301,"column":24},"action":"remove","lines":["g"],"id":9769}],[{"start":{"row":301,"column":23},"end":{"row":301,"column":24},"action":"insert","lines":["n"],"id":9770},{"start":{"row":301,"column":24},"end":{"row":301,"column":25},"action":"insert","lines":["o"]},{"start":{"row":301,"column":25},"end":{"row":301,"column":26},"action":"insert","lines":["g"]},{"start":{"row":301,"column":26},"end":{"row":301,"column":27},"action":"insert","lines":["."]}],[{"start":{"row":301,"column":26},"end":{"row":301,"column":27},"action":"remove","lines":["."],"id":9771},{"start":{"row":301,"column":25},"end":{"row":301,"column":26},"action":"remove","lines":["g"]},{"start":{"row":301,"column":24},"end":{"row":301,"column":25},"action":"remove","lines":["o"]}],[{"start":{"row":301,"column":24},"end":{"row":301,"column":25},"action":"insert","lines":["g"],"id":9772},{"start":{"row":301,"column":25},"end":{"row":301,"column":26},"action":"insert","lines":["o"]},{"start":{"row":301,"column":26},"end":{"row":301,"column":27},"action":"insert","lines":["."]},{"start":{"row":301,"column":27},"end":{"row":301,"column":28},"action":"insert","lines":["d"]},{"start":{"row":301,"column":28},"end":{"row":301,"column":29},"action":"insert","lines":["b"]},{"start":{"row":301,"column":29},"end":{"row":301,"column":30},"action":"insert","lines":["."]}],[{"start":{"row":301,"column":30},"end":{"row":301,"column":31},"action":"insert","lines":["a"],"id":9773},{"start":{"row":301,"column":31},"end":{"row":301,"column":32},"action":"insert","lines":["u"]},{"start":{"row":301,"column":32},"end":{"row":301,"column":33},"action":"insert","lines":["t"]},{"start":{"row":301,"column":33},"end":{"row":301,"column":34},"action":"insert","lines":["h"]},{"start":{"row":301,"column":34},"end":{"row":301,"column":35},"action":"insert","lines":["g"]},{"start":{"row":301,"column":35},"end":{"row":301,"column":36},"action":"insert","lines":["o"]}],[{"start":{"row":301,"column":35},"end":{"row":301,"column":36},"action":"remove","lines":["o"],"id":9774},{"start":{"row":301,"column":34},"end":{"row":301,"column":35},"action":"remove","lines":["g"]}],[{"start":{"row":301,"column":34},"end":{"row":301,"column":35},"action":"insert","lines":["o"],"id":9775},{"start":{"row":301,"column":35},"end":{"row":301,"column":36},"action":"insert","lines":["r"]},{"start":{"row":301,"column":36},"end":{"row":301,"column":37},"action":"insert","lines":["D"]},{"start":{"row":301,"column":37},"end":{"row":301,"column":38},"action":"insert","lines":["B"]}],[{"start":{"row":303,"column":25},"end":{"row":303,"column":45},"action":"remove","lines":["mongo.db.countriesDB"],"id":9776},{"start":{"row":303,"column":25},"end":{"row":303,"column":26},"action":"insert","lines":["d"]},{"start":{"row":303,"column":26},"end":{"row":303,"column":27},"action":"insert","lines":["a"]},{"start":{"row":303,"column":27},"end":{"row":303,"column":28},"action":"insert","lines":["t"]},{"start":{"row":303,"column":28},"end":{"row":303,"column":29},"action":"insert","lines":["a"]},{"start":{"row":303,"column":29},"end":{"row":303,"column":30},"action":"insert","lines":["b"]},{"start":{"row":303,"column":30},"end":{"row":303,"column":31},"action":"insert","lines":["a"]},{"start":{"row":303,"column":31},"end":{"row":303,"column":32},"action":"insert","lines":["s"]},{"start":{"row":303,"column":32},"end":{"row":303,"column":33},"action":"insert","lines":["e"]}],[{"start":{"row":295,"column":0},"end":{"row":295,"column":28},"action":"remove","lines":["    print(\"recipe=\",_recipe)"],"id":9777},{"start":{"row":294,"column":67},"end":{"row":295,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":293,"column":0},"end":{"row":293,"column":17},"action":"remove","lines":["    print(\"here\")"],"id":9778},{"start":{"row":292,"column":27},"end":{"row":293,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":310,"column":67},"end":{"row":311,"column":0},"action":"insert","lines":["",""],"id":9779},{"start":{"row":311,"column":0},"end":{"row":311,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":311,"column":0},"end":{"row":320,"column":50},"action":"insert","lines":["    categories=[\"country\",\"author\"]","    for category in categories:","        if category==\"country\":","            database=mongo.db.countriesDB","        elif category==\"author\":","            database=mongo.db.authorDB","        if _recipe[category]:","            _categorydoc=database.find_one({\"_id\":ObjectId(_recipe[category])})","            print(\"category doc\",_categorydoc)","            _recipe[category]=_categorydoc[\"name\"]"],"id":9780}],[{"start":{"row":266,"column":42},"end":{"row":266,"column":48},"action":"remove","lines":["recipe"],"id":9781},{"start":{"row":266,"column":42},"end":{"row":266,"column":43},"action":"insert","lines":["c"]},{"start":{"row":266,"column":43},"end":{"row":266,"column":44},"action":"insert","lines":["o"]},{"start":{"row":266,"column":44},"end":{"row":266,"column":45},"action":"insert","lines":["u"]},{"start":{"row":266,"column":45},"end":{"row":266,"column":46},"action":"insert","lines":["n"]},{"start":{"row":266,"column":46},"end":{"row":266,"column":47},"action":"insert","lines":["t"]},{"start":{"row":266,"column":47},"end":{"row":266,"column":48},"action":"insert","lines":["r"]},{"start":{"row":266,"column":48},"end":{"row":266,"column":49},"action":"insert","lines":["i"]},{"start":{"row":266,"column":49},"end":{"row":266,"column":50},"action":"insert","lines":["e"]},{"start":{"row":266,"column":50},"end":{"row":266,"column":51},"action":"insert","lines":["s"]}],[{"start":{"row":266,"column":59},"end":{"row":266,"column":87},"action":"remove","lines":["{\"country\":{'$exists':True}}"],"id":9782}],[{"start":{"row":267,"column":41},"end":{"row":267,"column":49},"action":"remove","lines":["recipeDB"],"id":9783},{"start":{"row":267,"column":41},"end":{"row":267,"column":42},"action":"insert","lines":["a"]},{"start":{"row":267,"column":42},"end":{"row":267,"column":43},"action":"insert","lines":["u"]},{"start":{"row":267,"column":43},"end":{"row":267,"column":44},"action":"insert","lines":["t"]},{"start":{"row":267,"column":44},"end":{"row":267,"column":45},"action":"insert","lines":["h"]},{"start":{"row":267,"column":45},"end":{"row":267,"column":46},"action":"insert","lines":["o"]},{"start":{"row":267,"column":46},"end":{"row":267,"column":47},"action":"insert","lines":["r"]},{"start":{"row":267,"column":47},"end":{"row":267,"column":48},"action":"insert","lines":["D"]},{"start":{"row":267,"column":48},"end":{"row":267,"column":49},"action":"insert","lines":["B"]}],[{"start":{"row":267,"column":55},"end":{"row":267,"column":83},"action":"remove","lines":["{ \"author\":{'$exists':True}}"],"id":9784}],[{"start":{"row":269,"column":0},"end":{"row":280,"column":58},"action":"remove","lines":["    unsorted_country_list=[]","    unsorted_author_list=[]","    ","    for recipe in full_list_of_country_recipes:","        #if the country key value is not blank add it to the list","        if recipe[\"country\"]:","            unsorted_country_list.append(recipe[\"country\"]) ","            ","    for recipe in full_list_of_author_recipes:","        #if the author key value is not blank add it to the list","        if recipe[\"author\"]:","            unsorted_author_list.append(recipe[\"author\"]) "],"id":9785},{"start":{"row":269,"column":0},"end":{"row":270,"column":4},"action":"remove","lines":["","    "]},{"start":{"row":269,"column":0},"end":{"row":270,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":269,"column":37},"end":{"row":270,"column":0},"action":"insert","lines":["",""],"id":9786},{"start":{"row":270,"column":0},"end":{"row":270,"column":4},"action":"insert","lines":["    "]},{"start":{"row":270,"column":4},"end":{"row":270,"column":5},"action":"insert","lines":["f"]},{"start":{"row":270,"column":5},"end":{"row":270,"column":6},"action":"insert","lines":["o"]},{"start":{"row":270,"column":6},"end":{"row":270,"column":7},"action":"insert","lines":["r"]}],[{"start":{"row":270,"column":7},"end":{"row":270,"column":8},"action":"insert","lines":[" "],"id":9787},{"start":{"row":270,"column":8},"end":{"row":270,"column":9},"action":"insert","lines":["k"]},{"start":{"row":270,"column":9},"end":{"row":270,"column":10},"action":"insert","lines":["e"]},{"start":{"row":270,"column":10},"end":{"row":270,"column":11},"action":"insert","lines":["y"]},{"start":{"row":270,"column":11},"end":{"row":270,"column":12},"action":"insert","lines":[","]}],[{"start":{"row":270,"column":12},"end":{"row":270,"column":13},"action":"insert","lines":[" "],"id":9788},{"start":{"row":270,"column":13},"end":{"row":270,"column":14},"action":"insert","lines":["v"]},{"start":{"row":270,"column":14},"end":{"row":270,"column":15},"action":"insert","lines":["a"]},{"start":{"row":270,"column":15},"end":{"row":270,"column":16},"action":"insert","lines":["l"]},{"start":{"row":270,"column":16},"end":{"row":270,"column":17},"action":"insert","lines":["u"]},{"start":{"row":270,"column":17},"end":{"row":270,"column":18},"action":"insert","lines":["e"]}],[{"start":{"row":270,"column":18},"end":{"row":270,"column":19},"action":"insert","lines":[" "],"id":9789},{"start":{"row":270,"column":19},"end":{"row":270,"column":20},"action":"insert","lines":["i"]},{"start":{"row":270,"column":20},"end":{"row":270,"column":21},"action":"insert","lines":["n"]}],[{"start":{"row":270,"column":21},"end":{"row":270,"column":22},"action":"insert","lines":[" "],"id":9790},{"start":{"row":270,"column":22},"end":{"row":270,"column":23},"action":"insert","lines":["f"]},{"start":{"row":270,"column":23},"end":{"row":270,"column":24},"action":"insert","lines":["u"]},{"start":{"row":270,"column":24},"end":{"row":270,"column":25},"action":"insert","lines":["l"]},{"start":{"row":270,"column":25},"end":{"row":270,"column":26},"action":"insert","lines":["l"]}],[{"start":{"row":270,"column":22},"end":{"row":270,"column":26},"action":"remove","lines":["full"],"id":9791},{"start":{"row":270,"column":22},"end":{"row":270,"column":49},"action":"insert","lines":["full_list_of_author_recipes"]}],[{"start":{"row":270,"column":49},"end":{"row":270,"column":50},"action":"insert","lines":[":"],"id":9792}],[{"start":{"row":269,"column":37},"end":{"row":270,"column":0},"action":"insert","lines":["",""],"id":9793},{"start":{"row":270,"column":0},"end":{"row":270,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":270,"column":4},"end":{"row":270,"column":16},"action":"insert","lines":["_author_list"],"id":9794}],[{"start":{"row":270,"column":16},"end":{"row":270,"column":17},"action":"insert","lines":["="],"id":9795}],[{"start":{"row":270,"column":17},"end":{"row":270,"column":19},"action":"insert","lines":["()"],"id":9796}],[{"start":{"row":272,"column":0},"end":{"row":273,"column":0},"action":"remove","lines":["    _country_list=list(dict.fromkeys(unsorted_country_list))",""],"id":9797}],[{"start":{"row":273,"column":0},"end":{"row":274,"column":0},"action":"insert","lines":["    _country_list=list(dict.fromkeys(unsorted_country_list))",""],"id":9798}],[{"start":{"row":272,"column":4},"end":{"row":272,"column":8},"action":"insert","lines":["    "],"id":9799}],[{"start":{"row":272,"column":21},"end":{"row":272,"column":62},"action":"remove","lines":["list(dict.fromkeys(unsorted_author_list))"],"id":9800}],[{"start":{"row":272,"column":20},"end":{"row":272,"column":21},"action":"remove","lines":["="],"id":9801}],[{"start":{"row":272,"column":20},"end":{"row":272,"column":21},"action":"insert","lines":["."],"id":9802},{"start":{"row":272,"column":21},"end":{"row":272,"column":22},"action":"insert","lines":["a"]},{"start":{"row":272,"column":22},"end":{"row":272,"column":23},"action":"insert","lines":["p"]},{"start":{"row":272,"column":23},"end":{"row":272,"column":24},"action":"insert","lines":["p"]},{"start":{"row":272,"column":24},"end":{"row":272,"column":25},"action":"insert","lines":["e"]},{"start":{"row":272,"column":25},"end":{"row":272,"column":26},"action":"insert","lines":["n"]},{"start":{"row":272,"column":26},"end":{"row":272,"column":27},"action":"insert","lines":["d"]}],[{"start":{"row":272,"column":27},"end":{"row":272,"column":29},"action":"insert","lines":["()"],"id":9803}],[{"start":{"row":272,"column":28},"end":{"row":272,"column":29},"action":"insert","lines":["v"],"id":9804},{"start":{"row":272,"column":29},"end":{"row":272,"column":30},"action":"insert","lines":["a"]},{"start":{"row":272,"column":30},"end":{"row":272,"column":31},"action":"insert","lines":["l"]},{"start":{"row":272,"column":31},"end":{"row":272,"column":32},"action":"insert","lines":["u"]},{"start":{"row":272,"column":32},"end":{"row":272,"column":33},"action":"insert","lines":["e"]}],[{"start":{"row":271,"column":8},"end":{"row":271,"column":13},"action":"remove","lines":["key, "],"id":9805}],[{"start":{"row":271,"column":44},"end":{"row":271,"column":45},"action":"insert","lines":["["],"id":9806},{"start":{"row":271,"column":45},"end":{"row":271,"column":46},"action":"insert","lines":["\""]},{"start":{"row":271,"column":46},"end":{"row":271,"column":47},"action":"insert","lines":["n"]},{"start":{"row":271,"column":47},"end":{"row":271,"column":48},"action":"insert","lines":["a"]},{"start":{"row":271,"column":48},"end":{"row":271,"column":49},"action":"insert","lines":["m"]},{"start":{"row":271,"column":49},"end":{"row":271,"column":50},"action":"insert","lines":["e"]},{"start":{"row":271,"column":50},"end":{"row":271,"column":51},"action":"insert","lines":["\""]}],[{"start":{"row":271,"column":51},"end":{"row":271,"column":52},"action":"insert","lines":["]"],"id":9807}],[{"start":{"row":270,"column":18},"end":{"row":270,"column":19},"action":"remove","lines":[")"],"id":9808},{"start":{"row":270,"column":17},"end":{"row":270,"column":18},"action":"remove","lines":["("]}],[{"start":{"row":270,"column":17},"end":{"row":270,"column":19},"action":"insert","lines":["[]"],"id":9809}],[{"start":{"row":272,"column":34},"end":{"row":273,"column":0},"action":"insert","lines":["",""],"id":9810},{"start":{"row":273,"column":0},"end":{"row":273,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":273,"column":0},"end":{"row":275,"column":0},"action":"remove","lines":["        ","    _country_list=list(dict.fromkeys(unsorted_country_list))",""],"id":9811},{"start":{"row":273,"column":0},"end":{"row":275,"column":34},"action":"insert","lines":["    _author_list=[]","    for value in full_list_of_author_recipes[\"name\"]:","        _author_list.append(value)"]}],[{"start":{"row":273,"column":5},"end":{"row":273,"column":11},"action":"remove","lines":["author"],"id":9812},{"start":{"row":273,"column":5},"end":{"row":273,"column":6},"action":"insert","lines":["c"]},{"start":{"row":273,"column":6},"end":{"row":273,"column":7},"action":"insert","lines":["o"]},{"start":{"row":273,"column":7},"end":{"row":273,"column":8},"action":"insert","lines":["u"]},{"start":{"row":273,"column":8},"end":{"row":273,"column":9},"action":"insert","lines":["n"]},{"start":{"row":273,"column":9},"end":{"row":273,"column":10},"action":"insert","lines":["t"]},{"start":{"row":273,"column":10},"end":{"row":273,"column":11},"action":"insert","lines":["r"]},{"start":{"row":273,"column":11},"end":{"row":273,"column":12},"action":"insert","lines":["y"]}],[{"start":{"row":274,"column":31},"end":{"row":274,"column":36},"action":"remove","lines":["uthor"],"id":9813},{"start":{"row":274,"column":30},"end":{"row":274,"column":31},"action":"remove","lines":["a"]}],[{"start":{"row":274,"column":30},"end":{"row":274,"column":37},"action":"insert","lines":["country"],"id":9814}],[{"start":{"row":275,"column":9},"end":{"row":275,"column":15},"action":"remove","lines":["author"],"id":9815},{"start":{"row":275,"column":9},"end":{"row":275,"column":16},"action":"insert","lines":["country"]}],[{"start":{"row":275,"column":39},"end":{"row":276,"column":0},"action":"insert","lines":["",""],"id":9816},{"start":{"row":276,"column":0},"end":{"row":276,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":271,"column":8},"end":{"row":271,"column":9},"action":"insert","lines":["k"],"id":9817},{"start":{"row":271,"column":9},"end":{"row":271,"column":10},"action":"insert","lines":["e"]},{"start":{"row":271,"column":10},"end":{"row":271,"column":11},"action":"insert","lines":["y"]},{"start":{"row":271,"column":11},"end":{"row":271,"column":12},"action":"insert","lines":[","]}],[{"start":{"row":274,"column":8},"end":{"row":274,"column":9},"action":"insert","lines":["k"],"id":9818},{"start":{"row":274,"column":9},"end":{"row":274,"column":10},"action":"insert","lines":["e"]},{"start":{"row":274,"column":10},"end":{"row":274,"column":11},"action":"insert","lines":["y"]},{"start":{"row":274,"column":11},"end":{"row":274,"column":12},"action":"insert","lines":[","]}],[{"start":{"row":274,"column":49},"end":{"row":274,"column":57},"action":"remove","lines":["[\"name\"]"],"id":9819}],[{"start":{"row":271,"column":48},"end":{"row":271,"column":56},"action":"remove","lines":["[\"name\"]"],"id":9820}],[{"start":{"row":271,"column":49},"end":{"row":272,"column":0},"action":"insert","lines":["",""],"id":9821},{"start":{"row":272,"column":0},"end":{"row":272,"column":8},"action":"insert","lines":["        "]},{"start":{"row":272,"column":8},"end":{"row":272,"column":9},"action":"insert","lines":["i"]},{"start":{"row":272,"column":9},"end":{"row":272,"column":10},"action":"insert","lines":["f"]},{"start":{"row":272,"column":10},"end":{"row":272,"column":11},"action":"insert","lines":["="]}],[{"start":{"row":272,"column":10},"end":{"row":272,"column":11},"action":"remove","lines":["="],"id":9822}],[{"start":{"row":272,"column":10},"end":{"row":272,"column":11},"action":"insert","lines":[" "],"id":9823},{"start":{"row":272,"column":11},"end":{"row":272,"column":12},"action":"insert","lines":["k"]},{"start":{"row":272,"column":12},"end":{"row":272,"column":13},"action":"insert","lines":["e"]},{"start":{"row":272,"column":13},"end":{"row":272,"column":14},"action":"insert","lines":["y"]},{"start":{"row":272,"column":14},"end":{"row":272,"column":15},"action":"insert","lines":["="]}],[{"start":{"row":272,"column":15},"end":{"row":272,"column":17},"action":"insert","lines":["\"\""],"id":9824}],[{"start":{"row":272,"column":15},"end":{"row":272,"column":17},"action":"remove","lines":["\"\""],"id":9825}],[{"start":{"row":272,"column":15},"end":{"row":272,"column":16},"action":"insert","lines":["n"],"id":9826},{"start":{"row":272,"column":16},"end":{"row":272,"column":17},"action":"insert","lines":["a"]},{"start":{"row":272,"column":17},"end":{"row":272,"column":18},"action":"insert","lines":["m"]},{"start":{"row":272,"column":18},"end":{"row":272,"column":19},"action":"insert","lines":["e"]},{"start":{"row":272,"column":19},"end":{"row":272,"column":20},"action":"insert","lines":["\""]}],[{"start":{"row":272,"column":15},"end":{"row":272,"column":16},"action":"insert","lines":["\""],"id":9827}],[{"start":{"row":272,"column":21},"end":{"row":272,"column":22},"action":"insert","lines":[":"],"id":9828}],[{"start":{"row":273,"column":8},"end":{"row":273,"column":12},"action":"insert","lines":["    "],"id":9829}],[{"start":{"row":272,"column":14},"end":{"row":272,"column":15},"action":"insert","lines":["="],"id":9830}],[{"start":{"row":276,"column":0},"end":{"row":277,"column":0},"action":"insert","lines":["        if key==\"name\":",""],"id":9831}],[{"start":{"row":277,"column":0},"end":{"row":277,"column":4},"action":"insert","lines":["    "],"id":9832}],[{"start":{"row":271,"column":11},"end":{"row":271,"column":17},"action":"remove","lines":[",value"],"id":9833}],[{"start":{"row":275,"column":11},"end":{"row":275,"column":17},"action":"remove","lines":[",value"],"id":9834}],[{"start":{"row":273,"column":32},"end":{"row":273,"column":37},"action":"remove","lines":["value"],"id":9835},{"start":{"row":273,"column":32},"end":{"row":273,"column":33},"action":"insert","lines":["k"]},{"start":{"row":273,"column":33},"end":{"row":273,"column":34},"action":"insert","lines":["e"]},{"start":{"row":273,"column":34},"end":{"row":273,"column":35},"action":"insert","lines":["y"]}],[{"start":{"row":273,"column":35},"end":{"row":273,"column":37},"action":"insert","lines":["[]"],"id":9836}],[{"start":{"row":273,"column":36},"end":{"row":273,"column":38},"action":"insert","lines":["\"\""],"id":9837}],[{"start":{"row":273,"column":37},"end":{"row":273,"column":38},"action":"insert","lines":["n"],"id":9838},{"start":{"row":273,"column":38},"end":{"row":273,"column":39},"action":"insert","lines":["a"]},{"start":{"row":273,"column":39},"end":{"row":273,"column":40},"action":"insert","lines":["m"]},{"start":{"row":273,"column":40},"end":{"row":273,"column":41},"action":"insert","lines":["e"]}],[{"start":{"row":277,"column":33},"end":{"row":277,"column":38},"action":"remove","lines":["value"],"id":9839},{"start":{"row":277,"column":33},"end":{"row":277,"column":44},"action":"insert","lines":["key[\"name\"]"]}],[{"start":{"row":272,"column":0},"end":{"row":272,"column":4},"action":"insert","lines":["    "],"id":9840},{"start":{"row":273,"column":0},"end":{"row":273,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":272,"column":8},"end":{"row":272,"column":12},"action":"remove","lines":["    "],"id":9857}],[{"start":{"row":273,"column":8},"end":{"row":273,"column":12},"action":"remove","lines":["    "],"id":9858}],[{"start":{"row":273,"column":44},"end":{"row":274,"column":0},"action":"insert","lines":["",""],"id":9859},{"start":{"row":274,"column":0},"end":{"row":274,"column":12},"action":"insert","lines":["            "]}]]},"ace":{"folds":[{"start":{"row":160,"column":13},"end":{"row":161,"column":75},"placeholder":"..."}],"scrolltop":2234,"scrollleft":0,"selection":{"start":{"row":255,"column":41},"end":{"row":255,"column":41},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":158,"state":"start","mode":"ace/mode/python"}},"timestamp":1563573078271}